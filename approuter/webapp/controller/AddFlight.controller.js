sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/json/JSONModel"],function(e,t,o){"use strict";return e.extend("ui5.rest.restwithui5.controller.AddFlight",{onInit:function(){console.log("Init called");this.DataRepository=this.getOwnerComponent().DataRepository;this.getView().setModel(new o({}),"addFlightFormModel");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("addFlight").attachPatternMatched(this._onPatternMatched,this)},_onPatternMatched:function(){console.log("pattern matched called for all flight controller");if(!window.localStorage.getItem("FBS_token")){this.oRouter.navTo("loginAdmin")}},onAddFlightButtonPress:function(){const e=this.getView().getModel("addFlightFormModel");console.log(e.getData());const o=this._formatPayload(e.getData());console.log("formattedPayload",o);this.DataRepository.addFlight(o).then(e=>{console.log(e);t.show("Flight created successfully");this.getView().getModel("addFlightFormModel").setData(null)}).catch(e=>{console.log(e);if(e.responseJSON.departureDateTime){e.responseJSON.departureDate=e.responseJSON.departureDateTime;e.responseJSON.departureTime=e.responseJSON.departureDateTime}if(e.responseJSON.arrivalDateTime){e.responseJSON.arrivalDate=e.responseJSON.arrivalDateTime;e.responseJSON.arrivalTime=e.responseJSON.arrivalDateTime}this.getView().getModel("addFlightFormModel").setProperty("/error",e.responseJSON);t.show("Failed to create flight")})},_formatPayload:function(e){console.log("_formatPayload called..",e);const t=e.departureDate;const o=e.departureTime;const a=e.arrivalDate;const s=e.arrivalTime;if(t&&o){const a=t.split("/").reverse().join("-");const s=a+"T"+o+"+00:00";e={...e,departureDateTime:s}}if(a&&s){const t=a.split("/").reverse().join("-");const o=t+"T"+s+"+00:00";e={...e,arrivalDateTime:o}}return e},onAddFlightViaJSONButtonPress:function(){console.log("Adding flight via json...");const e=this.getView().getModel("addFlightFormModel").getProperty("/addFlightJson");console.log("Json received is ",JSON.parse(e));const o=JSON.parse(e);this.DataRepository.addFlight(o).then(e=>{t.show("Flight addded successfully")}).catch(e=>{t.show("Flight addition failed. "+e.responseJSON?.message)})}})});
//# sourceMappingURL=AddFlight.controller.js.map