sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","ui5/rest/restwithui5/model/DataRepository","sap/m/MessageToast","sap/m/Dialog","sap/m/Button","sap/m/library","sap/m/List","sap/m/StandardListItem","sap/m/Text","ui5/rest/restwithui5/utils/utilFunctions"],function(t,e,o,n,s,i,r,a,g,l,u){"use strict";return t.extend("ui5.rest.restwithui5.controller.Detail",{onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("detail").attachPatternMatched(this.fetchDetails.bind(this));this.DataRepository=this.getOwnerComponent().DataRepository;this.oBus=sap.ui.getCore().getEventBus();this.oBus.subscribe("AircraftStructure","RenderPassengerForm",this.renderPassengerView,this)},fetchDetails:function(t){const e=t.getParameter("arguments").flightId;const o=this.getView().getModel();const n="/flight/"+e;const s=o.getProperty(n);if(!s){this.DataRepository.getFlight(e)}this._bindview(n)},convertToISOString:function(t){console.log("convertToISOString called");if(t){var e=new Date(t);if(!isNaN(e)){return e.toISOString()}else{return"Invalid date"}}return"N/A"},_bindview:function(t){this.getView().bindElement(t)},length:function(t){return t?t.length:0},onNavBack:function(){const t=this.getOwnerComponent().onNavBack();t()},payAmountButtonPress:async function(){console.log("payAmountButtonPress called");const t=this.getView().getModel();const e=this.getOwnerComponent().getModel().getProperty("/flight/passengers");if(!e||e.length==0){n.show("No passengers found");return}const o=t.getProperty("/flight/flightId");console.log(e,o);const s=this.formatPassengers(e);console.log("formattedPassengers",s);if(this._verifyPassengers()){this.oBooking=null;try{this.oBooking=await this.DataRepository.createBooking(s,o);this.showBookingDialog(this.oBooking)}catch(t){console.log(t);n.show("Please login...",{duration:3e3,closeOnBrowserNavigation:false});this.oRouter.navTo("login")}console.log(this.oBooking)}},showBookingDialog:function(t){console.log("show Booking dialog received",t);var e="<div class='p-2'>"+"<p><strong>Booking ID:</strong> "+t.bookingId+"</p>"+"<p><strong>Traveler Name:</strong> "+t.traveler.name+"</p>"+"<hr />"+"<div><strong>Passenger(s):</strong>"+t.passengers.map(t=>`<p><strong>Name</strong>: ${t.name}, <strong>ID Proof:</strong> ${t.idProof}, <strong>Age</strong>: ${t.age}, <strong>Seat No</strong>: ${t.seat}</p>`).join("")+"</div>"+"<hr />"+"<p><strong>Flight:</strong> "+t.flight.flightName+"</p>"+"<p><strong>Source Airport:</strong> "+t.flight.sourceAirport.airportName+" ("+t.flight.sourceAirport.city+", "+t.flight.sourceAirport.country+")</p>"+"<p><strong>Destination Airport:</strong> "+t.flight.destinationAirport.airportName+" ("+t.flight.destinationAirport.city+", "+t.flight.destinationAirport.country+")</p>"+"<p><strong>Departure:</strong> "+new Date(t.flight.departureDateTime).toLocaleString()+"</p>"+"<p><strong>Arrival:</strong> "+new Date(t.flight.arrivalDateTime).toLocaleString()+"</p>"+"<p><strong>Amount Paid:</strong> Rs "+t.amount.toFixed(2)+"</p>"+"</div>";if(!this.oDefaultDialog){this.oDefaultDialog=new s({title:"Happy Journey, your booking is confirmed!",contentWidth:"auto",endButton:new i({text:"OK",press:function(){this.getOwnerComponent().getRouter().navTo("Booking");this.oDefaultDialog.close()}.bind(this)})});this.getView().addDependent(this.oDefaultDialog)}this.oDefaultDialog.removeAllContent();this.oDefaultDialog.addContent(new sap.ui.core.HTML({content:e}));this.oDefaultDialog.open()},formatPassengers:function(t){const e=t.map(t=>({name:t.passengerName,age:t.passengerAge,idProof:t.passengerIdProof,requestedSeat:t.seat}));return e},_verifyPassengers:function(){const t=this.getView();const e=t.getBindingContext().getProperty("/flight/passengers");let o=true;e.forEach(t=>{if(Object.values(t).includes("")){n.show("All the Passenger details are required");o=false}else if(typeof Number(t.passengerAge)!=="number"){n.show("All the Passenger's Age must be a number");o=false}});return o},getDuration:function(t,e){console.log("getDuration",t,e);const o=u.getDuration(t,e);console.log(o);return o},renderPassengerView:function(){this.getView().rerender()},onRouteLeaving:function(){console.log("Details controller onexit fired...");this.getOwnerComponent().getModel().setProperty("/flight/selectedSeats",null)}})});
//# sourceMappingURL=Detail.controller.js.map