sap.ui.define(["sap/ui/core/mvc/Controller","ui5/rest/restwithui5/model/DataRepository","sap/ui/core/routing/History","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageToast"],(t,e,o,s,r,i)=>{"use strict";return t.extend("ui5.rest.restwithui5.controller.SearchFlights",{onInit:function(){var t=this.getOwnerComponent().getRouter();this.DataRepository=this.getOwnerComponent().DataRepository;t.getRoute("searchFlights").attachPatternMatched(this.onPatternMatched,this)},onPatternMatched:function(t){this.time=[{title:"All Day",startTime:"00:00",endTime:"23:59"},{title:"Morning",startTime:"00:00",endTime:"11:59"},{title:"Afternoon",startTime:"12:00",endTime:"16:59"},{title:"Evening",startTime:"17:00",endTime:"19:59"},{title:"Night",startTime:"20:00",endTime:"23:59"}];const e=this.getOwnerComponent().getModel();const o=t.getParameter("arguments");const s=this.getView().getModel();s.setProperty("/srcCode",o.srcCode);s.setProperty("/destCode",o.destCode);s.setProperty("/departureDate",o.date.split("-").reverse().join("-"));const r=e.getProperty("/destAirport");const i=e.getProperty("/srcAirport");console.log("srcAirport variable",i);e.setProperty("/srcAirport",i);e.setProperty("/destAirport",r);if(e.getProperty("/srcAirport")==null){this.DataRepository.getAirport(o.srcCode).then(t=>{e.setProperty("/srcAirport",t)})}if(e.getProperty("/destAirport")==null){this.DataRepository.getAirport(o.destCode).then(t=>{e.setProperty("/destAirport",t)})}this.DataRepository.getFlights(o.srcCode,o.destCode,o.date);e.setProperty("/date",o.date.split("-").reverse().join("/"));this.getView().getModel().setProperty("/time",this.time);const n=this.getView();const l=n.getModel().setProperty("/queryCompany",null);const c=n.getModel().setProperty("/queryMinSeats",null);n.getModel().setProperty("/SelectedTime",this.time[0]);this.onFilterButtonPress(null);this.getView().getModel().setProperty("/SelectedTime",this.time[0]);this.onFilterButtonPress(null)},clearFilter:function(){const t=this.getView();const e=this.byId("flightsList");const o=e.getBinding("items");o.filter([]);t.getModel().setProperty("/queryCompany",null);t.getModel().setProperty("/queryMinSeats",null);t.getModel().setProperty("/SelectedTime",null)},onCustomListItemPress:function(){console.log("Hello from SearchFlights")},navigateToDetails:function(t){const e=this.getOwnerComponent().getRouter();const o=t.getSource();const s=o.getBindingContext();const r=s.getProperty("flightId");e.navTo("detail",{flightId:r})},length:function(t){return t?t.length:0},onRefreshButtonPress:function(t){console.log("onRefreshButtonPress called");const e=t.getSource().data();console.log(e);console.log(e.srcAirportCode,e.destAirportCode,e.date);const o=e.date.split("/").reverse().join("-");this.DataRepository.getFlights(e.srcAirportCode,e.destAirportCode,o)},onFilterButtonPress:function(t){const e=this.getView();const o=[];const n=e.getModel().getProperty("/queryCompany");const l=e.getModel().getProperty("/queryMinSeats");const c=e.getModel().getProperty("/SelectedTime");if(n)o.push(new s("company",r.Contains,n));if(l)o.push(new s("availableSeatsCount",r.GE,l));if(c){let t=this.getView().getModel().getProperty("/SelectedTime");console.log("selectedTime",t);console.log(typeof t=="object");if(typeof t=="object"){t=t.title}const e=this.time.filter(e=>{console.log(e.title);return e.title==t});console.log(e);if(e.length>1){i.show("Unable to filter based on time");return}const n=e[0];console.log(n);const l=this.getOwnerComponent().getModel().getProperty("/date");const[c,a,g]=l.split("/");const p=new Date(g,a-1,c);const d=p.getTimezoneOffset();const h=Math.floor(Math.abs(d)/60);const u=Math.abs(d)%60;console.log(h,u);const m=new Date(p);m.setMinutes(Number(n.startTime.split(":")[0])*60+Number(n.startTime.split(":")[1]));console.log(m);const y=new Date(p);y.setMinutes(Number(n.endTime.split(":")[0])*60+Number(n.endTime.split(":")[1]));console.log(y);const f=m.toISOString();const P=y.toISOString();console.log(f);console.log(P);o.push(new s("departureDateTime",r.BT,f,P))}const a=this.byId("flightsList");const g=a.getBinding("items");g.filter(o)},toggleFiltersDisplay:function(t){const e=this.getView().byId("filters");e.toggleStyleClass("hideOnTablet")},onNavBack:function(){const t=this.getOwnerComponent().onNavBack();t()}})});
//# sourceMappingURL=SearchFlights.controller.js.map