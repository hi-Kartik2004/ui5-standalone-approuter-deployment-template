sap.ui.define(["sap/ui/core/format/DateFormat","sap/m/MessageToast","sap/ui/core/BusyIndicator"],function(e,t,a){"use strict";return{getFlights:function(e,t,o){console.log("getFlights called with ",e,t,o);a.show();jQuery.get({url:`${this._baseURL}/flight?srcCode=${e}&destCode=${t}&date=${o}`,success:function(e){const t=e.map(e=>{e.departureDateTimeLocalTimeStamp=new Date(e.departureDateTimeLocal).toLocaleString();e.arrivalDateTimeLocalTimeStamp=new Date(e.arrivalDateTimeLocal).toLocaleString();const t=new Date(e.departureDateTimeLocal);e.departureDate=t.getDate()+"-"+(Number(t.getMonth())+1)+"-"+t.getFullYear();e.duration=this._getDurationBetweenTimestamps(e.departureDateTimeLocal,e.arrivalDateTimeLocal);e.departureTimeLocal=this._formatTimeFromMilliseconds(new Date(e.departureDateTimeLocal).getTime());e.arrivalTimeLocal=this._formatTimeFromMilliseconds(new Date(e.arrivalDateTimeLocal).getTime());const a=e.flightName.split("-");e.splittedFlightName=a[1]+"-"+a[2]+"-"+a[3];return e});var o=this.getDataModel();o.setProperty("/flights",t);a.hide()}.bind(this)})},getFlight:function(e){a.show();jQuery.get({url:this._baseURL+"/flight/single"+"?flightId="+e,success:function(e){e.departureDateTimeLocalTimeStamp=new Date(e.departureDateTimeLocal).toLocaleString();e.arrivalDateTimeLocalTimeStamp=new Date(e.arrivalDateTimeLocal).toLocaleString();var t=this.getDataModel();t.setProperty("/flight",e);var o=sap.ui.getCore().getEventBus();o.publish("Flight","DataLoaded",{flight:e,message:"Flight data is ready"});a.hide()}.bind(this),error:function(e){console.log(e);t.show("Unable to fetch flights...");a.hide()}})},searchAirport:function(e){jQuery.get({url:this._baseURL+"/airport"+"?keyword="+e,success:function(e){console.log(e);var t=this.getDataModel();t.setProperty("/suggestedAirports",e)}.bind(this),error:function(e){console.log(e);alert("Something went wrong")}})},getAirport:function(e){return jQuery.get({url:this._baseURL+"/airport"+"?airportCode="+e,success:function(e){return e}.bind(this),error:function(e){console.log(e)}})},createBooking:function(e,t){a.show();console.log("passengers in flightService ",e);const o=window.localStorage.getItem("FBS_token");return jQuery.post({url:this._baseURL+"/booking",contentType:"application/json",data:JSON.stringify({passengers:e,flightId:t,travelerId:"6f4b48f8-d263-426d-9154-1e5add4d1ad5"}),headers:{Authorization:"Bearer "+o},success:function(e){a.hide();return e},error:function(e){a.hide();console.log(e);console.error(e.responseJSON.message);var t=sap.ui.getCore().getEventBus();t.publish("Flight","UnauthenticatedUser",{err:e})}})},_formatTimeFromMilliseconds:function(e){let t=new Date(e);let a=t.getHours().toString().padStart(2,"0");let o=t.getMinutes().toString().padStart(2,"0");return`${a}:${o}`},cancelSeats:function(e,o){a.show();console.log("CancelSeats called");const r=window.localStorage.getItem("FBS_token");jQuery.ajax({url:this._baseURL+"/booking",type:"PATCH",contentType:"application/json",headers:{Authorization:"Bearer "+r},data:JSON.stringify({cancelSeats:e,bookingId:o}),success:function(e){console.log("response in cancelSeats",e);t.show("Seats cancelled successfully");var o=sap.ui.getCore().getEventBus();o.publish("FlightService","cancelSeatsSuccess",{booking:e});a.hide()},error:function(e){t.show(e.responseJSON.message);console.log(e);a.hide()}})},_getDurationBetweenTimestamps:function(e,t){const a=new Date(t).getTime();const o=new Date(e).getTime();let r=a-o;let i=Math.floor(r/(1e3*60*60));let s=Math.floor(r%(1e3*60*60)/(1e3*60));let n=`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;return n}}});
//# sourceMappingURL=FlightService.js.map